{% extends 'base.html' %}
{% load i18n %}
{% load mytags %}
{% load crispy_forms_tags %}
{% load static %}

{% block content %}


    <div class="col-2   " >

        {% if team.group_Institution == request.user.profile.class_level and request.user.profile not in team.participants.all %}

            <button type="button" class="btn add_button"name="button"><a href="{% url 'join_team' team.id %}">{% trans 'join_the_team' %}</a></button>

        {% elif request.user.profile == team.manager %}

            <button type="button" class="btn add_button"name="button"><a href="{% url 'update_team' team.id %}">{% trans 'edit team' %}</a></button>

        {% else %}
            <button type="button" class="btn add_button" name="button"><a href="{% url 'leave_team' team.id %}">{% trans 'leave team' %} </a></button>

<<<<<<< HEAD
=======



    <div class="row">
        <div class="col-lg-6">
            <div class="card top-products">
                <div class="card-body">
                    <!-- {{team.id}} -->
                    <h3 class="card-header">{% trans 'participants' %}<span style= "margin-left:200px;"></span>
                        {% if user.profile.name == 'speaker' %}
                            <a  href="{% url 'add_member_team' team.id %}"><i style="color:#fffefc;"class="fas fa-user-plus team_style"></i></a>

                        {%  endif %}
                    </h3>
                    <div class="top-products-list">
                        <div class="product-item">
                            {% if team.group_Institution == request.user.profile.class_level and request.user.profile not in team.participants.all %}
                                <h3>{% trans 'current_amount_participants_lable' %}: {{team.participants.count}}</h3>

                            {% else %}
                                {% for student in team.participants.all %}
                                    <div class="student_list">
                                        <ol>
                                            <li><a href="">{{ student.user.first_name }} {{ student.user.last_name }}</a></li>
                                        </ol>
                                    </div>
                                {% endfor %}


                            {%endif %}


                        </div>
                        <!-- {% if user.is_speaker %}
                              <button type="button" class="btn" name="button"><a href="{% url 'add_member_team' team.id %}">{% trans 'add students' %}</a></button>
                            {%  endif %} -->

                    </div>
                </div>

<div>
{% if team.project.time_to_complete %}
                {% trans 'due_date' %} {{ team.due_date }}
    {% else %}
    {% trans "no_project_yet" %}
{% endif %}
</div>


            </div>
        </div>


        <div class="col-lg-6">
            <div class="card card-transactions">

                <div class="card-body">

                    {% if not team.project %}

                        <h3 class="card-header">{% trans 'project' %}</h3>

                        {% if user.is_speaker %}
                            <div class="student_list">
                                <button type="button" class="btn" data-bs-toggle="modal" data-bs-target="#ChoseProject">
                                    Chose a Project For the Team
                                </button>
                            </div>
                            <!-- Button trigger modal -->


                        {% endif %}
                    {% else %}
                        <h3 class="card-header team_style"><a href="{% url 'project_detail' team.project.id %}"> {{ team.project.name }} </a></h3>
                    {% endif %}


            </div>

        {% endif %}

    </div>




    <div class="row">
        <div class="col-lg-8"
        <h2>{% trans 'project_title' %}{{ team.project.name }} </h2>
        <p>{{ team.project.description }}</p>
        <a  href="{% url 'project_detail' team.project.id %}">{% trans 'read_more' %}</a>
    </div>


    <div class="col-lg-4"

    <!-- Collective Missions -->

    <div class="row">
        <div class="col">
            <div class="card">
                <h5 class="card-header">{% trans 'collective_mission' %}</h5>

                <div class="card-body">

                    <table id="zero-conf" class="display" style="width:100%">
                        <thead>
                        <tr>
                            <th>{% trans 'mission' %}</th>

                            <th>{% trans 'status' %}</th>
                            <th>{% trans 'points' %}</th>
                            <th>{% trans 'date' %}</th>

                            <th>{% if user.is_speaker %}
                                {% trans 'assign_mission' %}
                                {% elif user.is_student %}
                                {% trans 'join_mission' %}
                                {% endif %}
                            </th>
                        </tr>
                        </thead>
                        <tbody>

                        {% if user.profile in team.participants.all or user.is_peaker %}
                            {% for mission in team.project.collectivemission_set.all %}


                                <tr>
                                <td>
                                    <a
                                            href="{% url 'collective_mission_detail' mission.id %}">{{mission.name}}</a>
                                </td>
                                <td>{{mission.stage}}</td>
                                <td>{{mission.points}}</td>
                                <td>{{mission.due_date}}</td>
                                <td><a href="{% url 'assign_collective_mission_detail' mission.id %}">{% trans 'assign_mission' %}</a></td>
                                {% if user.is_student %}
                                <td><a href="{% url 'join_collective_mission_detail' mission.id %}">{% trans 'join_mission' %}</a></td>
                                {% endif %}
                            {% endfor %}


                        </tr>

                        {% endif %}
                        </tbody>

                    </table>
                </div>
            </div>
        </div>
    </div>



    {% if user.is_speaker %}

        <div class="row">
            <div class="col">
                <div class="card">
                    <h5 class="card-header">{% trans 'project mission' %}</h5>

                    <div class="card-body">
                        <table id="zero-conf" class="display" style="width:100%">
                            <thead>
                            <tr>
                                <th>{% trans 'mission' %}</th>
                                <th>{% trans 'attributed to' %}</th>
                                <th>{% trans 'stage of project' %}</th>
                                <th>{% trans 'points' %}</th>
                                <th>{% trans 'date' %}</th>
                                <th>{% trans 'status' %}</th>
                            </tr>

                            </thead>
                            <tbody>

                            {% for mission in team.project.individualmission_set.get_attributed_mission %}
                                <tr>
                                    <td>{{mission.name}}</td>
                                    <td>{{mission.attributed_to}}</td>
                                    <td>{{mission.stage}}</td>
                                    <td>{{mission.points}}</td>
                                    <td>{{mission.due_date}}</td>
                                    <td><a href="{% url 'submit_mission' mission.id  %}">See mission</a></td>
                                </tr>
                            {% endfor %}
                            </tbody>

                        </table>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}



    <!-- ------------------------------------------------------------------STUDENT VIEW HIS MISSION LIST  -->

    {% if user.is_student %}

        <div class="row">
        <div class="col">
        <div class="card">
        <h5 class="card-header">{% trans 'project mission' %}</h5>

        <div class="card-body">
            <p>My assigned missions</p>
            <table id="zero-conf" class="display" style="width:100%">
                <thead>
                <tr>
                    <th>{% trans 'project' %}</th>
                    <th>{% trans 'mission' %}</th>
                    <th>{% trans 'stage of project' %}</th>
                    <th>{% trans 'points' %}</th>
                    <th>{% trans 'date' %}</th>
                    <th>{% trans 'status' %}</th>
                </tr>
                </thead>
                <tbody>

                {% for mission in team.project.individualmission_set|student_missions:user.student %}

                    <tr>
                        <td><a href="
                                {% if user.profile == mission.attributed_to and not mission.response_file %}
                                {% url 'submit_mission' mission.id %}
                                {% else %}
                                {% url 'individual_mission_detail' mission.id %}
                                {% endif %}
                                ">{{mission.name}}</a> </td>
                        <td>{{mission.description}}</td>
                        <td>{{mission.stage}}</td>
                        <td>{{mission.points}}</td>
                        <td>{{mission.due_date}}</td>
                        <td>{{mission.status}}</td>
                    </tr>


    <div class="card">


        {% if user.is_speaker %}
            <a  class="btn-floating halfway-fab waves-effect waves-light red" href="{% url 'add_member_team' team.id %}"><i class="material-icons"</i>{% trans 'add' %}</a>
        {% endif %}

        <div class="card-content">
            {% if team.group_Institution == request.user.profile.class_level and request.user.profile not in team.participants.all %}
                <span class="card-title">{% trans "participants_nmbr_title" %}{{ team.participants.count }}</span>

                <ul class="collection">
                {% for student in team.participants.all %}
                    <li class="collection-item avatar">
                        <img src="{{  profile.profilepic_or_default }}" alt="" class="circle">
                        <span class="title">{{ student.user.first_name }} {{ student.user.last_name }}</span>
                        <a href="#!" class="secondary-content"><i class="material-icons">{% trans 'grade' %}</i></a>
                    </li>
                {% endfor %}
            {%endif %}

        </div>
    </div>



{% endblock %}

<script src="{% static  'backend/js/visible_buttons.js'%}" type="text/javascript"></script>

