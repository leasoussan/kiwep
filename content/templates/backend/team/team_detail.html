{% extends 'baseb.html' %}
{% load i18n %}

{% block content %}


{% if team.group_Institution == request.user.profile.class_level and request.user.profile not in team.participants.all %}

<a href="{% url 'join_team' team.id %}">Join The Team </a>


{% endif %}







<div class="row">
    <div class="col-lg-4">
        <div class="card top-products">
            <div class="card-body">
                <h5 class="card-title">Team {{ team.name }}Participants</h5>
                <div class="top-products-list">
                    <div class="product-item">
                        {% if team.group_Institution == request.user.profile.class_level and request.user.profile not in team.participants.all %}
                        <h3>Current amout of participants: {{team.participants.count}}</h3>

                        {% else %}
                        {% for student in team.participants.all %}
                        <h5><a href="">{{ student.user.first_name }} {{ student.user.last_name }}</a> </h5>
                        {% endfor %}

                        {%endif %}

                        {% if user.profile.name == 'speaker' %}
                        <a href="{% url 'add_member_team' team.id %}">Edit students</a>
                        {%  endif %}

                    </div>

                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-8">
        <div class="card card-transactions">
            <div class="card-body">
                <h5 class="card-title">Project Description</h5>
                <a href="{% url 'project_detail' team.project.id %}">{{team.project.name}}</a>
                <div>
                    {{team.project.description}}
                </div>
            </div>
        </div>
    </div>

</div>

{% if user.profile in team.participants.all or user.profile.name == "speaker" %}

<div class="row">
    <div class="col-xl">
        <div class="card">
            <div class="card-body">
                <p>Where are you at?</p>
                <div class="progress">
                    <div class="progress-bar bg-info progress-bar-striped progress-bar-animated" role="progressbar"
                        aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 75%"></div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endif %}





{% if user.profile.name == "speaker" %} 

<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-body">
               <a href="{% url 'create_mission' %}">Add Missions</a>
            </div>
        </div>
    </div>
</div>


{% endif %}
<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Available Missions</h5>

                <table id="zero-conf" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th>Title</th>

                            <th>Stage of Project</th>
                            <th>Points</th>
                            <th>Due date</th>
                            <th>Claim Mission</th>
                        </tr>
                    </thead>
                    <tbody>

                        {% if user.profile in team.participants.all or user.profile.name == "speaker" %}
                        {% for projectmission in team.teamprojectmission_set.team_available_mission  %}
                        <tr>
                            <td>
                                <a
                                    href="{% url 'mission_detail' projectmission.id %}">{{projectmission.mission.name}}</a>
                            </td>

                            <td>{{projectmission.stage}}</td>
                            <td>{{projectmission.points}}</td>
                            <td>{{projectmission.due_date}}</td>
                            <td><a href="{% url 'claim_mission' projectmission.id %}">Claim Mission</a></td>
                        </tr>
                        {% endfor %}
                        {% endif %}

                    </tbody>

                </table>
            </div>
        </div>
    </div>
</div>


<div class="row">
    <div class="col">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Project Mission</h5>
                <p>Here you can follow you peers working and progress on the project</p>
                <table id="zero-conf" class="display" style="width:100%">
                    <thead>
                        <tr>
                            <th>Title</th>
                            <th>Attributed to</th>
                            <th>Stage of Project</th>
                            <th>Points</th>
                            <th>Due date</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        
                        {% for projectmission in team.teamprojectmission_set.get_attributed_mission %}
                        <tr>
                            <td><a href="
                                {% if user.profile == projectmission.attributed_to and not projectmission.response_file %}
                                {% url 'submit_mission' projectmission.id %}
                            
                                {% else %}
                                {% url 'team_mission_detail' projectmission.id %}
                                {% endif %}
                                

                                ">{{projectmission.mission.name}}</a> </td>
                            <td>{{projectmission.attributed_to}}</td>
                            <td>{{projectmission.mission.stage}}</td>
                            <td>{{projectmission.points}}</td>
                            <td>{{projectmission.due_date}}</td>
                            <td>{{projectmission.status}}</td>
                        </tr>
                        {% endfor %}
                    </tbody>

                </table>
            </div>
        </div>
    </div>
</div>



{% endblock %}