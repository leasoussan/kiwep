{% load mytags %}

{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}

<div class="mission_detail_container">

    <div class="mission_detail_header">
        <button type="button" class="btn btn-light back_btn"><a href="{% url 'project_detail' object.project.id %}">{% trans 'back_to_project_button' %}</a></button>
        <!-- <a href="{% url 'project_detail' object.project.id %}"> <button>{% trans 'back_to_project_button' %}</button></a> -->

        <h3 class=""> {{ object.name }}</h3>


        <div class="speaker_action_btn_group">
            {% if user.is_speaker %}
                <button type="button" class="btn btn-secondary btn-sm"><a class="btn edit_button" href="{{ object.get_update_url }}">{% trans 'edit' %}</a></button>
                <!-- <a class="btn edit_button" href="{{ object.get_update_url }}">{% trans 'edit' %}</a> -->
            {% endif %}

        </div>

    </div>


    <div class="mission_detail_main_content">
        <div class="animation_div">
            <img class="image_animation" src="https://media.giphy.com/media/xT5LMVKCjhlKlhkdJm/giphy.gif" alt="this slowpoke moves">
        </div>
        <div class="mission_detail_details">

            <p class="mission_detail_description">{{object.description}}</p>


            <p class="detail_time_to_complete">
                <span>Time Left To Complete (days):</span>{{object.time_to_complete}} {% trans 'days' %}
            </p>

            <div class="mission_learning_info" >

                <h4 class ="">{% trans 'acquired_skills' %}</h4>
                {% for skill in object.acquired_skill.all %}
                    <li class="">{{skill.name}},  </li>
                {% endfor %}
  <button class="btn" style="background-color: whitesmoke">{% trans 'add_skills' %}</button>
            </div>

        </div>

    </div>




    <div class="mission_related_elements_content">

        {# here is the Resource List #}

        <div class="mission_resource_list_items">



            <div class="resource_container overflow-auto">
                {% if object.resource_set.exists %}

                    {% for resource in object.resource_set.all %}
                        <div class="resource_item_detail">

                            <div class="resource_cover">

                                <img class="image_resource" src="{{ resource.get_resourceImg_or_default }}">

                            </div>


                            <div class="missions_detail_resource">
                                <div class="detail_mission_alignment">
                                    <div class="resource_name">
                                        <a href="{% url 'resource_detail' resource.id %}">{{ resource.name }}</a>

                                    </div>
                                    <div class="resource_detail_button_control">
                                        <a href="{% url 'update_resource' resource.id %}"><img src="{% static 'backend/images/kiwep/edit.png' %}" alt="edit"> </a>
                                        <a href="{% url 'delete_resource' resource.id %}"> <img src="{% static 'backend/images/kiwep/trash.png' %}" alt="delete"> </a>

                                    </div>


                                </div>


                            </div>
                        </div>


                    {% endfor %}
                {% endif %}
            </div>


            <div class="btn_control_mission">
                <!-- Button trigger modal add Resource -->
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add_resource_modal">
                    {% trans "add_resource" %}
                </button>
            </div>
        </div>




        <div class="mission_status_box">

            {% if individualmission  %}

                {% if not object.attributed_to  %}
                   <h3 class="medium_title lable_mission_status"> {% trans 'mission_unclaimed' %}</h3>

                {% else %}
                    <h3>{% trans 'mission_is_attributed_to' %}{{ object.attributed_to }}</h3>

                {% endif %}



            {% elif collectivemission  %}
                {% if not object.attributed_to.all.exists %}
                    {% trans 'no_one_joined_yet' %}
                    {% if user.profile ==  object.team.manager %}

                        <a href="{% url 'assign_collective_mission_detail' object.id %}">{% trans 'assign_mission' %}</a>
                    {% endif %}

                {% else %}
                    {% for participant in object.attributed_to.all %}
                        <li> {{ participant }}</li>

                    {% endfor %}
                {% endif %}

            {% endif %}


            <div class="mission_answer_include">
                {% include "answer/answer.html"  with object=object %}</div>

        </div>

    </div>
</div>


<!-- Modal ADD RESOURCES-->



<div class="modal fade" id="add_resource_modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="add_resource" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-body">
                <ul class="nav nav-pills mb-3" id="pills-tab" >
                        <li class="nav-item" role="presentation">
                            <button class="nav-link " id="pills-create_resource-tab" data-bs-toggle="pill" data-bs-target="#pills-create_resource" type="button" role="tab" aria-controls="pills-create_resource" aria-selected="true">
                                {% trans 'create' %}</button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="pills-chose_resource-tab" data-bs-toggle="pill" data-bs-target="#pills-chose_resource" type="button" role="tab" aria-controls="pills-chose_resource" aria-selected="false">
                                {% trans 'chose' %}</button>
                        </li>
                    </ul>
                    <div class="tab-content" id="pills-tabContent">
                        <div class="tab-pane fade show active" id="pills-create_resource" role="tabpanel" aria-labelledby="pills-create_resource-tab">

                            <form method="POST" class="form-horizontal" action='{% url 'mission_create_resource' object.id %}' >
                                {% csrf_token %}
                                {{ resource_form|crispy }}
                                <button class="btn waves-effect waves-light modal-action modal-close add_button" type="submit" name="action">
                                    {% trans 'save'%}</button>
                            </form>
                        </div>
                        <div class="tab-pane fade" id="pills-chose_resource" role="tabpanel" aria-labelledby="pills-chose_resource-tab">
                            {% if project.resource_set.exists %}
                            <form method="POST" class="form-horizontal" action='{% url 'chose_resource' object.id %}' >
                                {% csrf_token %}
                                {{ chose_resource|crispy }}
                                <button class="btn waves-effect waves-light modal-action modal-close add_button" type="submit" name="action">
                                    {% trans 'save' %}</button>
                            </form>
                            {% endif %}
                        </div>
                    </div>
                </div>


                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

                </div>
            </div>
        </div>
    </div>


</div>


