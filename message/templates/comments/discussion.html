{% load mytags %}

{% load static %}
{% load i18n %}
{% load crispy_forms_tags %}


{% block css %}
    <link href="{% static 'backend/css/discussion.css' %}" rel="stylesheet">
{% endblock css %}



<div class="discussion_header">
    <div class="discussion_icon_detail"></div>
    <div class="discussion_team_detail"></div>
    <h4>{% trans 'discussions_of : ' %} </h4>
    {% if object.model %}
        <h2>{{object|return_objects_name}}</h2>
    {% endif %}
    <br>
    {{ object.return_class_name }}
    <p class="medium_title">{{object.name.title}}</p>
</div>


{% if not object.discussions %}
    <!-- Button trigger modal -->
    <div class="start_discussion_btn_team_detail_speaker">
        <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add_discussion_box">
            {% trans 'start_discussion' %}
        </button>
    </div>
{% else %}
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#add_discussion_box">
        {% trans 'add_discussion' %}</button>
{% endif     %}




<!-- Modal -->
<div class="modal fade" id="add_discussion_box" tabindex="-1" aria-labelledby="add_discussion_box" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="add_discussion_box">Modal title</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action = "{% url 'discussion_add' %}?next={{ request.path }} " >

                    {% csrf_token %}
                    {{ object.discussion_form|crispy }}

                    <button class="btn waves-effect waves-light secondary_button" type="submit" name="action">{% trans 'start_discussion' %}
                    </button>
                </form>
            </div>

        </div>
    </div>
</div>

{#<!-- Modal Structure -->#}
{#  <div id="add_discussion_box" class="modal">#}
{#    <div class="modal-content">#}
{##}
{#    <form method="POST" action = "{% url 'discussion_add' %}?next={{ request.path }} " >#}
{##}
{#        {% csrf_token %}#}
{#        {{ object.discussion_form|crispy }}#}
{##}
{#        <button class="btn waves-effect waves-light secondary_button" type="submit" name="action">{% trans 'start_discussion' %}#}
{#        </button>#}
{#    </form>#}
{##}
{#    </div>#}
{##}
{#    <div class="modal-footer">#}
{#      <a href="#!" class="modal-close waves-effect waves-green btn-flat">{% trans 'close' %}</a>#}
{#    </div>#}
{#  </div>#}
{##}
{##}


{#---------------------------------FOR DISCUSSION BOARD#}
<div class="discussion_list">


    {% with discussions=object.discussions.all %}

        {% for discussion in discussions %}

            <!-- Button trigger modal -->
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#_{{ discussion.id }}_discussion">
                {{discussion.title.title}}
            </button>

            <!-- Modal -->
            <div class="modal fade" id="_{{ discussion.id }}_discussion" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="_{{ discussion.id }}_discussionLable">{{discussion.title.title}}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            {% if discussion.replies %}

                                {% for comment in discussion.replies.all %}

                                    <div class="card card-body">
                                        {% if comment.user.profile == request.user.profile %}

                                            <div class="speech-bubble-left user_comment">
                                                {{ comment.comment_text }}
                                            </div>
                                        {% else %}
                                            <div class="speech-bubble-right profile_comment">
                                                {{ comment.comment_text}}
                                            </div>
                                        {% endif %}
                                    </div>


                                {% endfor %}

                                <div class="add_comment_input">

                                    <form method="POST" action = "{% url 'comment_add' %}?next={{ request.path }}" >
                                        {% csrf_token %}
                                        {{ discussion.comment_form|crispy }}
                                        <div class="col s1">
                                            <button type="submit" class="waves-effect waves-light btn"><i class="material-icons">send</i></button>
                                        </div>
                                    </form>


                                </div>
                            {% endif %}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

                        </div>
                    </div>
                </div>
            </div>


        {% endfor %}
        </div>
    {% endwith %}


{##}
{##}
{##}
{#            <div class="discussion_board_row">#}
{#                <p>#}
{#                    <a class="btn btn-primary" data-bs-toggle="collapse" href="#discussion_box_detail" role="button" aria-expanded="false" aria-controls="discussion_box_detail">#}
{#                        {{discussion.title.title }}   </a>#}
{##}
{#                </p>#}
{#            </div>#}
{#        {% endfor %}#}
{#        {% if discussion.replies %}#}
{#            {% for comment in discussion.replies.all %}#}
{#                <div class="collapse" id="discussion_box_detail">#}
{##}
{#                <div class="card card-body">#}
{#                    {% if comment.user.profile == request.user.profile %}#}
{##}
{#                        <div class="speech-bubble-left user_comment">#}
{#                            {{ comment.comment_text }}#}
{#                        </div>#}
{#                    {% else %}#}
{#                        <div class="speech-bubble-right profile_comment">#}
{#                            {{ comment.comment_text}}#}
{#                        </div>#}
{#                    {% endif %}#}
{#                </div>#}
{#            {% endfor %}#}
{##}
{#            <div class="add_comment_input">#}
{##}
{#            <form method="POST" action = "{% url 'comment_add' %}?next={{ request.path }}" >#}
{#                {% csrf_token %}#}
{#                {{ discussion.comment_form|crispy }}#}
{#                <div class="col s1">#}
{#                    <button type="submit" class="waves-effect waves-light btn"><i class="material-icons">send</i></button>#}
{#                </div>#}
{#            </form>#}
{##}
{#        {% endif %}#}
{#        </div>#}
{##}
{##}
{##}
{#        </div>#}
{##}
{##}
{#    {% endwith %}#}


{% block javascript %}
    <script>

    </script>
{% endblock javascript %}